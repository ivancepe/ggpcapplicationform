<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GKG | Application Form</title>
    <link rel="icon" type="image/x-icon" href="images/gkg.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: none;
            transition: background 0.3s, color 0.3s;
        }
        .dark body {
            background: #181f2a;
            color: #e5e7eb;
        }
        .dark .backdrop-blur-lg {
            background-color: rgba(30, 41, 59, 0.7) !important;
            border-color: #334155 !important;
        }
        .dark input,
        .dark select,
        .dark textarea {
            background-color: #232b3a !important;
            color: #e5e7eb !important;
            border-color: #334155 !important;
        }
        /* Force autofill fields to use dark backgrounds in dark mode */
        .dark input:-webkit-autofill,
        .dark select:-webkit-autofill,
        .dark textarea:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 1000px #232b3a inset !important;
            -webkit-text-fill-color: #e5e7eb !important;
            caret-color: #e5e7eb !important;
            transition: background-color 9999s ease-in-out 0s;
        }
        .dark label {
            color: #cbd5e1 !important;
        }
        .dark .text-gray-700 {
            color: #e5e7eb !important;
        }
        .dark .text-gray-500 {
            color: #94a3b8 !important;
        }
        .dark .bg-white {
            background-color: #232b3a !important;
        }
        .dark .border-gray-200 {
            border-color: #334155 !important;
        }
        .dark .shadow-xl {
            box-shadow: 0 10px 40px 0 rgba(30,41,59,0.5) !important;
        }
        .dark .bg-gradient-to-r {
            background-image: linear-gradient(to right, #1E90FF, #334155) !important;
        }
        .dark .file\:bg-gray-100 {
            background-color: #334155 !important;
        }
        .dark .file\:text-gray-700 {
            color: #e5e7eb !important;
        }
        .dark .bg-green-500 {
            background-color: #22c55e !important;
        }
        .dark .bg-red-500 {
            background-color: #ef4444 !important;
        }
        .dark .bg-black {
            background-color: #181f2a !important;
        }
        @media (min-width: 1024px) {
            .form-scroll {
                max-height: 100vh;
                overflow-y: auto;
                direction: rtl; /* Move scrollbar to the left */
            }
            .form-scroll > * {
                direction: ltr; /* Keep content left-to-right */
            }
        }
        /* Modern scrollbar styles */
        .form-scroll::-webkit-scrollbar {
            width: 10px;
            left: 0;
        }
        .form-scroll::-webkit-scrollbar-thumb {
            background: #1E90FF;
            border-radius: 8px;
        }
        .form-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        .form-scroll {
            scrollbar-width: thin;
            scrollbar-color: #1E90FF #f1f1f1;
        }
        /* Floating particles animation */
        #particles-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
        }
        #menuIcon line {
            transition: 
                transform 0.3s cubic-bezier(.4,2,.6,1), 
                opacity 0.2s;
            transform-origin: 12px 12px;
        }
        .menu-open #line1 {
            transform: translateY(5px) rotate(45deg);
        }
        .menu-open #line2 {
            opacity: 0;
        }
        .menu-open #line3 {
            transform: translateY(-5px) rotate(-45deg);
        }
    </style>
</head>
<body class="min-h-screen font-sans transition-colors duration-300">
    <!-- Floating Particles Background -->
    <canvas id="particles-bg"></canvas>
    <!-- Navigation Bar -->
    <nav class="w-full bg-white shadow-md fixed top-0 left-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Logo Left -->
            <div class="flex items-center space-x-3">
                <img src="images/GGPC logo.png" alt="Company Logo" class="h-10 w-auto object-contain" />
            </div>
            <!-- Navigation Links Right (hidden on md and below) -->
            <div id="navLinks" class="hidden md:flex items-center space-x-8">
                <a href="https://www.ggpc.com.ph/" target="_blank" class="text-gray-700 hover:text-[#1E90FF] font-semibold transition">GGPC Website</a>
                <a href="https://ggpc-exam.netlify.app/index.html" target="_blank" class="text-gray-700 hover:text-[#1E90FF] font-semibold transition">Pre-employment Examination</a>
            </div>
            <!-- Hamburger Menu Icon (animated lines, visible on md and below) -->
            <button id="menuToggle" class="md:hidden flex items-center justify-center p-2 rounded transition" aria-label="Open Menu">
                <!-- Minimalist Hamburger/X Icon -->
                <svg id="menuIcon" class="w-7 h-7 text-[#1E3A8A] transition-all duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line id="line1" x1="4" y1="7" x2="20" y2="7" stroke="currentColor" stroke-linecap="round"/>
                    <line id="line2" x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-linecap="round"/>
                    <line id="line3" x1="4" y1="17" x2="20" y2="17" stroke="currentColor" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
        <!-- Mobile Menu (hidden by default) -->
        <div id="mobileMenu" class="md:hidden fixed top-16 left-0 w-full bg-white shadow-lg z-50 hidden transition-all">
            <div class="flex flex-col items-center py-4 space-y-2">
                <a href="https://www.ggpc.com.ph/" target="_blank" class="block w-full text-center text-gray-700 hover:text-[#1E90FF] font-semibold py-2 transition">GGPC Website</a>
                <a href="https://ggpc-preemployment-exam.netlify.app/index.html" target="_blank" class="block w-full text-center text-gray-700 hover:text-[#1E90FF] font-semibold py-2 transition">Pre-employment Examination</a>
            </div>
        </div>
    </nav>
    <div class="flex flex-col h-screen w-full pt-16">
        <!-- Left: Form (now full width on desktop) -->
        <div class="w-full h-screen flex flex-col items-center justify-start form-scroll pt-2 lg:pt-4 overflow-y-auto">
            <form id="applicationForm" class="w-full max-w-3xl backdrop-blur-lg p-8 rounded-2xl shadow-xl border border-gray-200 space-y-6">
                <h2 class="text-3xl font-bold text-center mb-4 tracking-tight">Application Form</h2>
                <p class="text-gray-500 text-base text-center mb-6">Please fill out the form below to apply for a position at our company.</p>  
                <div>
                    <label for="name" class="block text-gray-700 font-semibold mb-1">Full Name</label>
                    <input type="text" id="name" name="name" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition placeholder:text-gray-400"
                        placeholder="Last, First Middle" />
                </div>
                <div>
                    <label for="birthdate" class="block text-gray-700 font-semibold mb-1">Birthdate</label>
                    <input type="date" id="birthdate" name="birthdate" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition placeholder:text-gray-400" />
                </div>
                <div>
                    <label for="phone" class="block text-gray-700 font-semibold mb-1">Phone Number</label>
                    <input type="tel" id="phone" name="phone" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition placeholder:text-gray-400"
                        placeholder="Enter your phone number" />
                </div>
                <div>
                    <label for="email" class="block text-gray-700 font-semibold mb-1">Email Address</label>
                    <input type="email" id="email" name="email" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition placeholder:text-gray-400"
                        placeholder="Enter your email address" />
                </div>
                <div>
                    <label for="address" class="block text-gray-700 font-semibold mb-1">Home Address</label>
                    <input type="text" id="address" name="address" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition placeholder:text-gray-400"
                        placeholder="Enter your home address" />
                </div>
                <div>
                    <label for="position" class="block text-gray-700 font-semibold mb-1">Position</label>
                    <select id="position" name="position" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition bg-white text-gray-700">
                        <option value="" disabled selected>Select a position</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div>
                    <label for="education" class="block text-gray-700 font-semibold mb-1">Educational Attainment</label>
                    <select id="education" name="education" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition bg-white text-gray-700">
                        <option value="" disabled selected>Select your education</option>
                        <option>Highschool</option>
                        <option>Vocational</option>
                        <option>Associate</option>
                        <option>Bachelor</option>
                        <option>Master</option>
                        <option>Doctorate</option>
                    </select>
                </div>
                <div>
                    <label for="course" class="block text-gray-700 font-semibold mb-1">Course</label>
                    <input type="text" id="course" name="course" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition placeholder:text-gray-400"
                        placeholder="Enter your course" />
                </div>
                <div>
                    <label for="expectedSalary" class="block text-gray-700 font-semibold mb-1">Expected Salary</label>
                    <input type="number" id="expectedSalary" name="expectedSalary" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition placeholder:text-gray-400"
                        placeholder="Enter your expected salary" />
                </div>
                <div>
                    <label for="availability" class="block text-gray-700 font-semibold mb-1">Date of Availability (Phone Screening)</label>
                    <textarea id="availability" name="availability" required
                        rows="3"
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition placeholder:text-gray-400 resize-y"
                        placeholder="Enter your date of availability"></textarea>
                </div>
                <div>
                    <label for="resume" class="block text-gray-700 font-semibold mb-1">Resume <span class="text-gray-400 text-xs">(PDF only)</span></label>
                    <input type="file" id="resume" name="resume" accept=".pdf,application/pdf" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:border-[#1E90FF] transition file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:bg-gray-100 file:text-gray-700" />
                </div>
                <button type="submit"
                    class="w-full bg-gradient-to-r from-[#1E90FF] to-blue-700 text-white py-3 rounded-lg font-bold shadow hover:from-blue-700 hover:to-[#1E90FF] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#1E90FF] focus:ring-offset-2">
                    Submit Application
                </button>
            </form>
        </div>
    </div>
    <!-- Success and Failed Messages -->
    <div id="successMessage" class="fixed top-8 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg text-lg font-semibold opacity-0 pointer-events-none transition-opacity duration-500 z-50">
        Application submitted successfully!
    </div>
    <div id="failedMessage" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg text-lg font-semibold opacity-0 pointer-events-none transition-opacity duration-500 z-50">
        A record with this name already exists.
    </div>
    <!-- Fun Loading Animation -->
    <div id="loadingOverlay" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="flex flex-col items-center">
            <div class="animate-spin rounded-full border-8 border-blue-400 border-t-transparent h-20 w-20 mb-4"></div>
            <div class="text-white text-xl font-bold">Submitting... ðŸš€</div>
        </div>
    </div>
    <button id="darkModeToggle" class="fixed bottom-6 right-6 z-50 bg-white dark:bg-[#232b3a] border border-gray-200 dark:border-[#334155] rounded-full shadow-lg p-3 hover:bg-gray-100 dark:hover:bg-[#334155] transition">
        <svg id="sunIcon" class="w-6 h-6 text-[#1E90FF]" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="display:none;">
            <circle cx="12" cy="12" r="5" stroke="currentColor"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 1v2m0 18v2m11-11h-2M3 12H1m16.95 7.07l-1.41-1.41M6.34 6.34L4.93 4.93m12.02 0l-1.41 1.41M6.34 17.66l-1.41 1.41"/>
        </svg>
        <svg id="moonIcon" class="w-6 h-6 text-[#1E90FF]" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="display:none;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/>
        </svg>
    </button>
    <script>
    document.getElementById('applicationForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const name = document.getElementById('name').value;
        const birthdate = document.getElementById('birthdate').value;
        const position = document.getElementById('position').value;
        const phone = document.getElementById('phone').value;
        const email = document.getElementById('email').value;
        const fileInput = document.getElementById('resume');
        const file = fileInput.files[0];
        const address = document.getElementById('address').value;
        const education = document.getElementById('education').value;
        const course = document.getElementById('course').value;
        const expectedSalary = document.getElementById('expectedSalary').value;
        const availability = document.getElementById('availability').value;

        // Auto-calculate age from birthdate
        function calculateAge(birthdateStr) {
            const today = new Date();
            const birthDate = new Date(birthdateStr);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }
        const age = calculateAge(birthdate);

        if (!file) {
            alert('Please select a file.');
            return;
        }
        if (file.type !== "application/pdf" && !file.name.toLowerCase().endsWith('.pdf')) {
            alert('Only PDF files are allowed for the resume.');
            return;
        }
        const formData = new FormData();
        formData.append('name', name);
        formData.append('birthdate', birthdate);
        formData.append('age', age); // <-- Auto-calculated age
        formData.append('position', position);
        formData.append('phone', phone);
        formData.append('email', email);
        formData.append('resume', file);
        formData.append('address', address);
        formData.append('education', education);
        formData.append('course', course);
        formData.append('expectedSalary', expectedSalary);
        formData.append('availability', availability);

        // Show loading animation
        const loading = document.getElementById('loadingOverlay');
        loading.style.opacity = '1';
        loading.style.pointerEvents = 'auto';

        // Check for duplicate name before submitting
        const checkRes = await fetch('https://ggpcapplicationform.onrender.com/check-name', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, position })
        });
        const checkData = await checkRes.json();
        if (checkData.exists) {
            // If same name and email but different position, allow application
            if (checkData.sameNameEmailDifferentPosition) {
                // Allow application to proceed
            } else {
                // Hide loading animation
                loading.style.opacity = '0';
                loading.style.pointerEvents = 'none';

                // Determine error typee
                let errorMsg = 'A record with this name already exists.';
                if (checkData.sameNameAndEmail) {
                    errorMsg = 'A record with this name and email already exists for this position.';
                } else if (checkData.sameEmailDifferentName) {
                    errorMsg = 'A record with this email already exists.';
                }

                // Show animated failed message
                const failMsg = document.getElementById('failedMessage');
                failMsg.textContent = errorMsg;
                failMsg.style.opacity = '1';
                failMsg.style.pointerEvents = 'auto';
                setTimeout(() => {
                    failMsg.style.opacity = '0';
                    failMsg.style.pointerEvents = 'none';
                    failMsg.textContent = 'A record with this name already exists.'; // reset default
                }, 2000); // visible for 2 seconds
                return;
            }
        }

        const response = await fetch('https://ggpcapplicationform.onrender.com/apply', {
            method: 'POST',
            body: formData
        });

        // Hide loading animation
        loading.style.opacity = '0';
        loading.style.pointerEvents = 'none';

        if (response.ok) {
            // Show animated success message
            const msg = document.getElementById('successMessage');
            msg.style.opacity = '1';
            msg.style.pointerEvents = 'auto';
            setTimeout(() => {
                msg.style.opacity = '0';
                msg.style.pointerEvents = 'none';
            }, 2000); // visible for 2 seconds

            document.getElementById('applicationForm').reset();
        } else {
            alert('Failed to submit application.');
        }
    });

    // Floating Particles Animation
    const canvas = document.getElementById('particles-bg');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function createParticles() {
        particles = [];
        const count = Math.floor(window.innerWidth / 30);
        for (let i = 0; i < count; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                r: Math.random() * 2 + 1,
                dx: (Math.random() - 0.5) * 0.5,
                dy: (Math.random() - 0.5) * 0.5,
                alpha: Math.random() * 0.5 + 0.3
            });
        }
    }
    createParticles();
    window.addEventListener('resize', createParticles);

    function animateParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let p of particles) {
            ctx.save();
            ctx.globalAlpha = p.alpha;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
            ctx.fillStyle = "#1E90FF";
            ctx.shadowColor = "#1E90FF";
            ctx.shadowBlur = 8;
            ctx.fill();
            ctx.restore();

            p.x += p.dx;
            p.y += p.dy;

            // Wrap around edges
            if (p.x < 0) p.x = canvas.width;
            if (p.x > canvas.width) p.x = 0;
            if (p.y < 0) p.y = canvas.height;
            if (p.y > canvas.height) p.y = 0;
        }
        requestAnimationFrame(animateParticles);
    }
    animateParticles();

    // Dark Mode Toggle
    const darkToggle = document.getElementById('darkModeToggle');
    const html = document.documentElement;
    // Load preference
    if (localStorage.getItem('theme') === 'dark' || 
        (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        html.classList.add('dark');
    }
    function updateDarkModeIcons() {
        const isDark = html.classList.contains('dark');
        document.getElementById('sunIcon').style.display = isDark ? '' : 'none';
        document.getElementById('moonIcon').style.display = isDark ? 'none' : '';
    }

    // Initial icon state
    updateDarkModeIcons();

    darkToggle.addEventListener('click', () => {
        html.classList.toggle('dark');
        if (html.classList.contains('dark')) {
            localStorage.setItem('theme', 'dark');
        } else {
            localStorage.setItem('theme', 'light');
        }
        updateDarkModeIcons();
    });

    // Also update on page load if theme is set
    updateDarkModeIcons();

    // Hamburger menu toggle
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    const menuIcon = document.getElementById('menuIcon');

    menuToggle.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        menuIcon.classList.toggle('menu-open');
    });

    // Optional: Hide mobile menu when clicking outside or resizing to desktop
    window.addEventListener('resize', () => {
        if (window.innerWidth >= 768) {
            mobileMenu.classList.add('hidden');
            menuIcon.classList.remove('menu-open');
        }
    });
    document.addEventListener('click', (e) => {
        if (!mobileMenu.contains(e.target) && !menuToggle.contains(e.target)) {
            mobileMenu.classList.add('hidden');
            menuIcon.classList.remove('menu-open');
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
      fetch('https://script.google.com/macros/s/AKfycbyY09JmbRGAQnW3d35lDteT-1n2E0qtjhJxm8jl7UTBdT1jwlvMlTcuN96Mts9aLO4I/exec')
        .then(response => response.json())
        .then(positions => {
          const dropdown = document.getElementById('position'); // Change to your dropdown's ID
          dropdown.innerHTML = '<option value="">Select a position</option>';
          positions.forEach(pos => {
            const option = document.createElement('option');
            option.value = pos;
            option.textContent = pos;
            dropdown.appendChild(option);
          });
        })
        .catch(err => {
          console.error('Failed to load positions:', err);
        });
    });
    </script>
</body>
</html>